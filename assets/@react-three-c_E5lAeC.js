import{_ as U}from"./@babel-4x1g4sPU.js";import{r as u}from"./react-BCmcDKje.js";import{L as Pe,T as $t,R as Bt,U as Nt,a as Gt,O as $e,P as Be,S as Je,b as Ce,N as Ut,A as qt,B as Vt,M as Xt,C as Yt,V as N,c as dt,W as Zt,d as Kt,e as Jt,f as Qt,g as er,h as tr,i as rr,D as nr,j as ye,k as Ne,l as or,m as ir,E as pt,n as sr,o as ar,p as cr,q as ae,r as lr,s as ur,t as fr}from"./three-BUs102tf.js";import{u as dr}from"./react-use-measure-Bfyt93N7.js";import{F as pr,u as mr}from"./its-fine-BzdHtxa6.js";import{R as vr,c as se}from"./react-reconciler-Crmn_0Na.js";import{s as Qe}from"./scheduler-CzFDRTuY.js";import{c as hr}from"./react-dom-BBmqrJIA.js";import{c as mt}from"./zustand-aIGwL4nT.js";import"./maath-DiaBYwbQ.js";import{D as gr,G as Ge,a as yr,M as Se,O as br}from"./three-stdlib-J7Sko9lO.js";import{s as wr,p as Er,c as _r}from"./suspend-react-BKIKQNXN.js";const Ue={},Mr=e=>void Object.assign(Ue,e);function xr(e,t){function r(n,{args:o=[],attach:m,...d},p){let M=`${n[0].toUpperCase()}${n.slice(1)}`,g;if(n==="primitive"){if(d.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const l=d.object;g=oe(l,{type:n,root:p,attach:m,primitive:!0})}else{const l=Ue[M];if(!l)throw new Error(`R3F: ${M} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");g=oe(new l(...o),{type:n,root:p,attach:m,memoizedProps:{args:o}})}return g.__r3f.attach===void 0&&(g instanceof Vt?g.__r3f.attach="geometry":g instanceof Xt&&(g.__r3f.attach="material")),M!=="inject"&&Ae(g,d),g}function i(n,o){let m=!1;if(o){var d,p;(d=o.__r3f)!=null&&d.attach?Oe(n,o,o.__r3f.attach):o.isObject3D&&n.isObject3D&&(n.add(o),m=!0),m||(p=n.__r3f)==null||p.objects.push(o),o.__r3f||oe(o,{}),o.__r3f.parent=n,He(o),ie(o)}}function c(n,o,m){let d=!1;if(o){var p,M;if((p=o.__r3f)!=null&&p.attach)Oe(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){o.parent=n,o.dispatchEvent({type:"added"});const g=n.children.filter(f=>f!==o),l=g.indexOf(m);n.children=[...g.slice(0,l),o,...g.slice(l)],d=!0}d||(M=n.__r3f)==null||M.objects.push(o),o.__r3f||oe(o,{}),o.__r3f.parent=n,He(o),ie(o)}}function a(n,o,m=!1){n&&[...n].forEach(d=>h(o,d,m))}function h(n,o,m){if(o){var d,p,M;if(o.__r3f&&(o.__r3f.parent=null),(d=n.__r3f)!=null&&d.objects&&(n.__r3f.objects=n.__r3f.objects.filter(x=>x!==o)),(p=o.__r3f)!=null&&p.attach)ot(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){var g;n.remove(o),(g=o.__r3f)!=null&&g.root&&Dr(_e(o),o)}const f=(M=o.__r3f)==null?void 0:M.primitive,b=!f&&(m===void 0?o.dispose!==null:m);if(!f){var l;a((l=o.__r3f)==null?void 0:l.objects,o,b),a(o.children,o,b)}if(delete o.__r3f,b&&o.dispose&&o.type!=="Scene"){const x=()=>{try{o.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?Qe.unstable_scheduleCallback(Qe.unstable_IdlePriority,x):x()}ie(n)}}function v(n,o,m,d){var p;const M=(p=n.__r3f)==null?void 0:p.parent;if(!M)return;const g=r(o,m,n.__r3f.root);if(n.children){for(const l of n.children)l.__r3f&&i(g,l);n.children=n.children.filter(l=>!l.__r3f)}n.__r3f.objects.forEach(l=>i(g,l)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||h(M,n),g.parent&&(g.__r3f.autoRemovedBeforeAppend=!0),i(M,g),g.raycast&&g.__r3f.eventCount&&_e(g).getState().internal.interaction.push(g),[d,d.alternate].forEach(l=>{l!==null&&(l.stateNode=g,l.ref&&(typeof l.ref=="function"?l.ref(g):l.ref.current=g))})}const s=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:vr({createInstance:r,removeChild:h,appendChild:i,appendInitialChild:i,insertBefore:c,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,o)=>{if(!o)return;const m=n.getState().scene;m.__r3f&&(m.__r3f.root=n,i(m,o))},removeChildFromContainer:(n,o)=>{o&&h(n.getState().scene,o)},insertInContainerBefore:(n,o,m)=>{if(!o||!m)return;const d=n.getState().scene;d.__r3f&&c(d,o,m)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var o;return!!((o=n==null?void 0:n.__r3f)!=null?o:{}).handlers},prepareUpdate(n,o,m,d){var p;if(((p=n==null?void 0:n.__r3f)!=null?p:{}).primitive&&d.object&&d.object!==n)return[!0];{const{args:g=[],children:l,...f}=d,{args:b=[],children:x,..._}=m;if(!Array.isArray(g))throw new Error("R3F: the args prop must be an array!");if(g.some((S,R)=>S!==b[R]))return[!0];const E=Et(n,f,_,!0);return E.changes.length?[!1,E]:null}},commitUpdate(n,[o,m],d,p,M,g){o?v(n,d,M,g):Ae(n,m)},commitMount(n,o,m,d){var p;const M=(p=n.__r3f)!=null?p:{};n.raycast&&M.handlers&&M.eventCount&&_e(n).getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>oe(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var o;const{attach:m,parent:d}=(o=n.__r3f)!=null?o:{};m&&d&&ot(d,n,m),n.isObject3D&&(n.visible=!1),ie(n)},unhideInstance(n,o){var m;const{attach:d,parent:p}=(m=n.__r3f)!=null?m:{};d&&p&&Oe(p,n,d),(n.isObject3D&&o.visible==null||o.visible)&&(n.visible=!0),ie(n)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:()=>t?t():se.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&D.fun(performance.now)?performance.now:D.fun(Date.now)?Date.now:()=>0,scheduleTimeout:D.fun(setTimeout)?setTimeout:void 0,cancelTimeout:D.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Ae}}var et,tt;const Re=e=>"colorSpace"in e||"outputColorSpace"in e,vt=()=>{var e;return(e=Ue.ColorManagement)!=null?e:null},ht=e=>e&&e.isOrthographicCamera,Pr=e=>e&&e.hasOwnProperty("current"),me=typeof window<"u"&&((et=window.document)!=null&&et.createElement||((tt=window.navigator)==null?void 0:tt.product)==="ReactNative")?u.useLayoutEffect:u.useEffect;function gt(e){const t=u.useRef(e);return me(()=>void(t.current=e),[e]),t}function Cr({set:e}){return me(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class yt extends u.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}yt.getDerivedStateFromError=()=>({error:!0});const bt="__default",rt=new Map,Sr=e=>e&&!!e.memoized&&!!e.changes;function wt(e){var t;const r=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],r),e[1]):e}const ue=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function _e(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const D={obj:e=>e===Object(e)&&!D.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:r="shallow",objects:i="reference",strict:c=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(D.str(e)||D.num(e))return e===t;const a=D.obj(e);if(a&&i==="reference")return e===t;const h=D.arr(e);if(h&&r==="reference")return e===t;if((h||a)&&e===t)return!0;let v;for(v in e)if(!(v in t))return!1;if(a&&r==="shallow"&&i==="shallow"){for(v in c?t:e)if(!D.equ(e[v],t[v],{strict:c,objects:"reference"}))return!1}else for(v in c?t:e)if(e[v]!==t[v])return!1;if(D.und(v)){if(h&&e.length===0&&t.length===0||a&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Rr(e){const t={nodes:{},materials:{}};return e&&e.traverse(r=>{r.name&&(t.nodes[r.name]=r),r.material&&!t.materials[r.material.name]&&(t.materials[r.material.name]=r.material)}),t}function Or(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function oe(e,t){const r=e;return r.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Ie(e,t){let r=e;if(t.includes("-")){const i=t.split("-"),c=i.pop();return r=i.reduce((a,h)=>a[h],e),{target:r,key:c}}else return{target:r,key:t}}const nt=/-\d+$/;function Oe(e,t,r){if(D.str(r)){if(nt.test(r)){const a=r.replace(nt,""),{target:h,key:v}=Ie(e,a);Array.isArray(h[v])||(h[v]=[])}const{target:i,key:c}=Ie(e,r);t.__r3f.previousAttach=i[c],i[c]=t}else t.__r3f.previousAttach=r(e,t)}function ot(e,t,r){var i,c;if(D.str(r)){const{target:a,key:h}=Ie(e,r),v=t.__r3f.previousAttach;v===void 0?delete a[h]:a[h]=v}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(c=t.__r3f)==null||delete c.previousAttach}function Et(e,{children:t,key:r,ref:i,...c},{children:a,key:h,ref:v,...s}={},y=!1){var n;const o=(n=e==null?void 0:e.__r3f)!=null?n:{},m=Object.entries(c),d=[];if(y){const M=Object.keys(s);for(let g=0;g<M.length;g++)c.hasOwnProperty(M[g])||m.unshift([M[g],bt+"remove"])}m.forEach(([M,g])=>{var l;if((l=e.__r3f)!=null&&l.primitive&&M==="object"||D.equ(g,s[M]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(M))return d.push([M,g,!0,[]]);let f=[];M.includes("-")&&(f=M.split("-")),d.push([M,g,!1,f]);for(const b in c){const x=c[b];b.startsWith(`${M}-`)&&d.push([b,x,!1,b.split("-")])}});const p={...c};return o.memoizedProps&&o.memoizedProps.args&&(p.args=o.memoizedProps.args),o.memoizedProps&&o.memoizedProps.attach&&(p.attach=o.memoizedProps.attach),{memoized:p,changes:d}}const Ar=typeof process<"u"&&!1;function Ae(e,t){var r,i,c;const a=(r=e.__r3f)!=null?r:{},h=a.root,v=(i=h==null||h.getState==null?void 0:h.getState())!=null?i:{},{memoized:s,changes:y}=Sr(t)?t:Et(e,t),n=a.eventCount;e.__r3f&&(e.__r3f.memoizedProps=s);for(let m=0;m<y.length;m++){let[d,p,M,g]=y[m];if(Re(e)){const x="srgb",_="srgb-linear";d==="encoding"?(d="colorSpace",p=p===3001?x:_):d==="outputEncoding"&&(d="outputColorSpace",p=p===3001?x:_)}let l=e,f=l[d];if(g.length&&(f=g.reduce((b,x)=>b[x],e),!(f&&f.set))){const[b,...x]=g.reverse();l=x.reverse().reduce((_,E)=>_[E],e),d=b}if(p===bt+"remove")if(l.constructor){let b=rt.get(l.constructor);b||(b=new l.constructor,rt.set(l.constructor,b)),p=b[d]}else p=0;if(M)p?a.handlers[d]=p:delete a.handlers[d],a.eventCount=Object.keys(a.handlers).length;else if(f&&f.set&&(f.copy||f instanceof Pe)){if(Array.isArray(p))f.fromArray?f.fromArray(p):f.set(...p);else if(f.copy&&p&&p.constructor&&(Ar?f.constructor.name===p.constructor.name:f.constructor===p.constructor))f.copy(p);else if(p!==void 0){const b=f instanceof Yt;!b&&f.setScalar?f.setScalar(p):f instanceof Pe&&p instanceof Pe?f.mask=p.mask:f.set(p),!vt()&&!v.linear&&b&&f.convertSRGBToLinear()}}else if(l[d]=p,l[d]instanceof $t&&l[d].format===Bt&&l[d].type===Nt){const b=l[d];Re(b)&&Re(v.gl)?b.colorSpace=v.gl.outputColorSpace:b.encoding=v.gl.outputEncoding}ie(e)}if(a.parent&&e.raycast&&n!==a.eventCount){const m=_e(e).getState().internal,d=m.interaction.indexOf(e);d>-1&&m.interaction.splice(d,1),a.eventCount&&m.interaction.push(e)}return!(y.length===1&&y[0][0]==="onUpdate")&&y.length&&(c=e.__r3f)!=null&&c.parent&&He(e),e}function ie(e){var t,r;const i=(t=e.__r3f)==null||(r=t.root)==null||r.getState==null?void 0:r.getState();i&&i.internal.frames===0&&i.invalidate()}function He(e){e.onUpdate==null||e.onUpdate(e)}function Tr(e,t){e.manual||(ht(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function be(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function jr(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return se.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return se.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return se.ContinuousEventPriority;default:return se.DefaultEventPriority}}function _t(e,t,r,i){const c=r.get(t);c&&(r.delete(t),r.size===0&&(e.delete(i),c.target.releasePointerCapture(i)))}function Dr(e,t){const{internal:r}=e.getState();r.interaction=r.interaction.filter(i=>i!==t),r.initialHits=r.initialHits.filter(i=>i!==t),r.hovered.forEach((i,c)=>{(i.eventObject===t||i.object===t)&&r.hovered.delete(c)}),r.capturedMap.forEach((i,c)=>{_t(r.capturedMap,t,i,c)})}function Lr(e){function t(s){const{internal:y}=e.getState(),n=s.offsetX-y.initialClick[0],o=s.offsetY-y.initialClick[1];return Math.round(Math.sqrt(n*n+o*o))}function r(s){return s.filter(y=>["Move","Over","Enter","Out","Leave"].some(n=>{var o;return(o=y.__r3f)==null?void 0:o.handlers["onPointer"+n]}))}function i(s,y){const n=e.getState(),o=new Set,m=[],d=y?y(n.internal.interaction):n.internal.interaction;for(let l=0;l<d.length;l++){const f=ue(d[l]);f&&(f.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(s,n);function p(l){const f=ue(l);if(!f||!f.events.enabled||f.raycaster.camera===null)return[];if(f.raycaster.camera===void 0){var b;f.events.compute==null||f.events.compute(s,f,(b=f.previousRoot)==null?void 0:b.getState()),f.raycaster.camera===void 0&&(f.raycaster.camera=null)}return f.raycaster.camera?f.raycaster.intersectObject(l,!0):[]}let M=d.flatMap(p).sort((l,f)=>{const b=ue(l.object),x=ue(f.object);return!b||!x?l.distance-f.distance:x.events.priority-b.events.priority||l.distance-f.distance}).filter(l=>{const f=be(l);return o.has(f)?!1:(o.add(f),!0)});n.events.filter&&(M=n.events.filter(M,n));for(const l of M){let f=l.object;for(;f;){var g;(g=f.__r3f)!=null&&g.eventCount&&m.push({...l,eventObject:f}),f=f.parent}}if("pointerId"in s&&n.internal.capturedMap.has(s.pointerId))for(let l of n.internal.capturedMap.get(s.pointerId).values())o.has(be(l.intersection))||m.push(l.intersection);return m}function c(s,y,n,o){const m=e.getState();if(s.length){const d={stopped:!1};for(const p of s){const M=ue(p.object)||m,{raycaster:g,pointer:l,camera:f,internal:b}=M,x=new N(l.x,l.y,0).unproject(f),_=O=>{var w,A;return(w=(A=b.capturedMap.get(O))==null?void 0:A.has(p.eventObject))!=null?w:!1},E=O=>{const w={intersection:p,target:y.target};b.capturedMap.has(O)?b.capturedMap.get(O).set(p.eventObject,w):b.capturedMap.set(O,new Map([[p.eventObject,w]])),y.target.setPointerCapture(O)},S=O=>{const w=b.capturedMap.get(O);w&&_t(b.capturedMap,p.eventObject,w,O)};let R={};for(let O in y){let w=y[O];typeof w!="function"&&(R[O]=w)}let P={...p,...R,pointer:l,intersections:s,stopped:d.stopped,delta:n,unprojectedPoint:x,ray:g.ray,camera:f,stopPropagation(){const O="pointerId"in y&&b.capturedMap.get(y.pointerId);if((!O||O.has(p.eventObject))&&(P.stopped=d.stopped=!0,b.hovered.size&&Array.from(b.hovered.values()).find(w=>w.eventObject===p.eventObject))){const w=s.slice(0,s.indexOf(p));a([...w,p])}},target:{hasPointerCapture:_,setPointerCapture:E,releasePointerCapture:S},currentTarget:{hasPointerCapture:_,setPointerCapture:E,releasePointerCapture:S},nativeEvent:y};if(o(P),d.stopped===!0)break}}return s}function a(s){const{internal:y}=e.getState();for(const n of y.hovered.values())if(!s.length||!s.find(o=>o.object===n.object&&o.index===n.index&&o.instanceId===n.instanceId)){const m=n.eventObject.__r3f,d=m==null?void 0:m.handlers;if(y.hovered.delete(be(n)),m!=null&&m.eventCount){const p={...n,intersections:s};d.onPointerOut==null||d.onPointerOut(p),d.onPointerLeave==null||d.onPointerLeave(p)}}}function h(s,y){for(let n=0;n<y.length;n++){const o=y[n].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(s)}}function v(s){switch(s){case"onPointerLeave":case"onPointerCancel":return()=>a([]);case"onLostPointerCapture":return y=>{const{internal:n}=e.getState();"pointerId"in y&&n.capturedMap.has(y.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(y.pointerId)&&(n.capturedMap.delete(y.pointerId),a([]))})}}return function(n){const{onPointerMissed:o,internal:m}=e.getState();m.lastEvent.current=n;const d=s==="onPointerMove",p=s==="onClick"||s==="onContextMenu"||s==="onDoubleClick",g=i(n,d?r:void 0),l=p?t(n):0;s==="onPointerDown"&&(m.initialClick=[n.offsetX,n.offsetY],m.initialHits=g.map(b=>b.eventObject)),p&&!g.length&&l<=2&&(h(n,m.interaction),o&&o(n)),d&&a(g);function f(b){const x=b.eventObject,_=x.__r3f,E=_==null?void 0:_.handlers;if(_!=null&&_.eventCount)if(d){if(E.onPointerOver||E.onPointerEnter||E.onPointerOut||E.onPointerLeave){const S=be(b),R=m.hovered.get(S);R?R.stopped&&b.stopPropagation():(m.hovered.set(S,b),E.onPointerOver==null||E.onPointerOver(b),E.onPointerEnter==null||E.onPointerEnter(b))}E.onPointerMove==null||E.onPointerMove(b)}else{const S=E[s];S?(!p||m.initialHits.includes(x))&&(h(n,m.interaction.filter(R=>!m.initialHits.includes(R))),S(b)):p&&m.initialHits.includes(x)&&h(n,m.interaction.filter(R=>!m.initialHits.includes(R)))}}c(g,n,l,f)}}return{handlePointer:v}}const Mt=e=>!!(e!=null&&e.render),xt=u.createContext(null),kr=(e,t)=>{const r=mt((v,s)=>{const y=new N,n=new N,o=new N;function m(l=s().camera,f=n,b=s().size){const{width:x,height:_,top:E,left:S}=b,R=x/_;f instanceof N?o.copy(f):o.set(...f);const P=l.getWorldPosition(y).distanceTo(o);if(ht(l))return{width:x/l.zoom,height:_/l.zoom,top:E,left:S,factor:1,distance:P,aspect:R};{const O=l.fov*Math.PI/180,w=2*Math.tan(O/2)*P,A=w*(x/_);return{width:A,height:w,top:E,left:S,factor:x/A,distance:P,aspect:R}}}let d;const p=l=>v(f=>({performance:{...f.performance,current:l}})),M=new dt;return{set:v,get:s,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(l=1)=>e(s(),l),advance:(l,f)=>t(l,f,s()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new tr,pointer:M,mouse:M,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const l=s();d&&clearTimeout(d),l.performance.current!==l.performance.min&&p(l.performance.min),d=setTimeout(()=>p(s().performance.max),l.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:m},setEvents:l=>v(f=>({...f,events:{...f.events,...l}})),setSize:(l,f,b,x,_)=>{const E=s().camera,S={width:l,height:f,top:x||0,left:_||0,updateStyle:b};v(R=>({size:S,viewport:{...R.viewport,...m(E,n,S)}}))},setDpr:l=>v(f=>{const b=wt(l);return{viewport:{...f.viewport,dpr:b,initialDpr:f.viewport.initialDpr||b}}}),setFrameloop:(l="always")=>{const f=s().clock;f.stop(),f.elapsedTime=0,l!=="never"&&(f.start(),f.elapsedTime=0),v(()=>({frameloop:l}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:u.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(l,f,b)=>{const x=s().internal;return x.priority=x.priority+(f>0?1:0),x.subscribers.push({ref:l,priority:f,store:b}),x.subscribers=x.subscribers.sort((_,E)=>_.priority-E.priority),()=>{const _=s().internal;_!=null&&_.subscribers&&(_.priority=_.priority-(f>0?1:0),_.subscribers=_.subscribers.filter(E=>E.ref!==l))}}}}}),i=r.getState();let c=i.size,a=i.viewport.dpr,h=i.camera;return r.subscribe(()=>{const{camera:v,size:s,viewport:y,gl:n,set:o}=r.getState();if(s.width!==c.width||s.height!==c.height||y.dpr!==a){var m;c=s,a=y.dpr,Tr(v,s),n.setPixelRatio(y.dpr);const d=(m=s.updateStyle)!=null?m:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(s.width,s.height,d)}v!==h&&(h=v,o(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(v)}})))}),r.subscribe(v=>e(v)),r};let we,Fr=new Set,zr=new Set,Ir=new Set;function Te(e,t){if(e.size)for(const{callback:r}of e.values())r(t)}function fe(e,t){switch(e){case"before":return Te(Fr,t);case"after":return Te(zr,t);case"tail":return Te(Ir,t)}}let je,De;function Le(e,t,r){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),je=t.internal.subscribers,we=0;we<je.length;we++)De=je[we],De.ref.current(De.store.getState(),i,r);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Hr(e){let t=!1,r,i,c;function a(s){i=requestAnimationFrame(a),t=!0,r=0,fe("before",s);for(const n of e.values()){var y;c=n.store.getState(),c.internal.active&&(c.frameloop==="always"||c.internal.frames>0)&&!((y=c.gl.xr)!=null&&y.isPresenting)&&(r+=Le(s,c))}if(fe("after",s),r===0)return fe("tail",s),t=!1,cancelAnimationFrame(i)}function h(s,y=1){var n;if(!s)return e.forEach(o=>h(o.store.getState(),y));(n=s.gl.xr)!=null&&n.isPresenting||!s.internal.active||s.frameloop==="never"||(s.internal.frames=Math.min(60,s.internal.frames+y),t||(t=!0,requestAnimationFrame(a)))}function v(s,y=!0,n,o){if(y&&fe("before",s),n)Le(s,n,o);else for(const m of e.values())Le(s,m.store.getState());y&&fe("after",s)}return{loop:a,invalidate:h,advance:v}}function Pt(){const e=u.useContext(xt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function B(e=r=>r,t){return Pt()(e,t)}function ve(e,t=0){const r=Pt(),i=r.getState().internal.subscribe,c=gt(e);return me(()=>i(c,t,r),[t,i,r]),null}const it=new WeakMap;function Ct(e,t){return function(r,...i){let c=it.get(r);return c||(c=new r,it.set(r,c)),e&&e(c),Promise.all(i.map(a=>new Promise((h,v)=>c.load(a,s=>{s.scene&&Object.assign(s,Rr(s.scene)),h(s)},t,s=>v(new Error(`Could not load ${a}: ${s==null?void 0:s.message}`)))))).finally(()=>c.dispose==null?void 0:c.dispose())}}function Z(e,t,r,i){const c=Array.isArray(t)?t:[t],a=wr(Ct(r,i),[e,...c],{equal:D.equ});return Array.isArray(t)?a:a[0]}Z.preload=function(e,t,r){const i=Array.isArray(t)?t:[t];return Er(Ct(r),[e,...i])};Z.clear=function(e,t){const r=Array.isArray(t)?t:[t];return _r([e,...r])};const ce=new Map,{invalidate:st,advance:at}=Hr(ce),{reconciler:Me,applyProps:G}=xr(ce,jr),ne={objects:"shallow",strict:!1},Wr=(e,t)=>{const r=typeof e=="function"?e(t):e;return Mt(r)?r:new Zt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function $r(e,t){const r=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:c,top:a,left:h,updateStyle:v=r}=t;return{width:i,height:c,top:a,left:h,updateStyle:v}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:c,top:a,left:h}=e.parentElement.getBoundingClientRect();return{width:i,height:c,top:a,left:h,updateStyle:r}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:r};return{width:0,height:0,top:0,left:0}}function Br(e){const t=ce.get(e),r=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const c=typeof reportError=="function"?reportError:console.error,a=i||kr(st,at),h=r||Me.createContainer(a,se.ConcurrentRoot,null,!1,null,"",c,null);t||ce.set(e,{fiber:h,store:a});let v,s=!1,y;return{configure(n={}){let{gl:o,size:m,scene:d,events:p,onCreated:M,shadows:g=!1,linear:l=!1,flat:f=!1,legacy:b=!1,orthographic:x=!1,frameloop:_="always",dpr:E=[1,2],performance:S,raycaster:R,camera:P,onPointerMissed:O}=n,w=a.getState(),A=w.gl;w.gl||w.set({gl:A=Wr(o,e)});let I=w.raycaster;I||w.set({raycaster:I=new Gt});const{params:K,...k}=R||{};if(D.equ(k,I,ne)||G(I,{...k}),D.equ(K,I.params,ne)||G(I,{params:{...I.params,...K}}),!w.camera||w.camera===y&&!D.equ(y,P,ne)){y=P;const T=P instanceof Kt,L=T?P:x?new $e(0,0,0,0,.1,1e3):new Be(75,0,.1,1e3);T||(L.position.z=5,P&&G(L,P),!w.camera&&!(P!=null&&P.rotation)&&L.lookAt(0,0,0)),w.set({camera:L}),I.camera=L}if(!w.scene){let T;d instanceof Je?T=d:(T=new Je,d&&G(T,d)),w.set({scene:oe(T)})}if(!w.xr){var q;const T=(C,Y)=>{const V=a.getState();V.frameloop!=="never"&&at(C,!0,V,Y)},L=()=>{const C=a.getState();C.gl.xr.enabled=C.gl.xr.isPresenting,C.gl.xr.setAnimationLoop(C.gl.xr.isPresenting?T:null),C.gl.xr.isPresenting||st(C)},z={connect(){const C=a.getState().gl;C.xr.addEventListener("sessionstart",L),C.xr.addEventListener("sessionend",L)},disconnect(){const C=a.getState().gl;C.xr.removeEventListener("sessionstart",L),C.xr.removeEventListener("sessionend",L)}};typeof((q=A.xr)==null?void 0:q.addEventListener)=="function"&&z.connect(),w.set({xr:z})}if(A.shadowMap){const T=A.shadowMap.enabled,L=A.shadowMap.type;if(A.shadowMap.enabled=!!g,D.boo(g))A.shadowMap.type=Ce;else if(D.str(g)){var F;const z={basic:Jt,percentage:Qt,soft:Ce,variance:er};A.shadowMap.type=(F=z[g])!=null?F:Ce}else D.obj(g)&&Object.assign(A.shadowMap,g);(T!==A.shadowMap.enabled||L!==A.shadowMap.type)&&(A.shadowMap.needsUpdate=!0)}const H=vt();H&&("enabled"in H?H.enabled=!b:"legacyMode"in H&&(H.legacyMode=b)),s||G(A,{outputEncoding:l?3e3:3001,toneMapping:f?Ut:qt}),w.legacy!==b&&w.set(()=>({legacy:b})),w.linear!==l&&w.set(()=>({linear:l})),w.flat!==f&&w.set(()=>({flat:f})),o&&!D.fun(o)&&!Mt(o)&&!D.equ(o,A,ne)&&G(A,o),p&&!w.events.handlers&&w.set({events:p(a)});const W=$r(e,m);return D.equ(W,w.size,ne)||w.setSize(W.width,W.height,W.updateStyle,W.top,W.left),E&&w.viewport.dpr!==wt(E)&&w.setDpr(E),w.frameloop!==_&&w.setFrameloop(_),w.onPointerMissed||w.set({onPointerMissed:O}),S&&!D.equ(S,w.performance,ne)&&w.set(T=>({performance:{...T.performance,...S}})),v=M,s=!0,this},render(n){return s||this.configure(),Me.updateContainer(u.createElement(Nr,{store:a,children:n,onCreated:v,rootElement:e}),h,null,()=>{}),a},unmount(){St(e)}}}function Nr({store:e,children:t,onCreated:r,rootElement:i}){return me(()=>{const c=e.getState();c.set(a=>({internal:{...a.internal,active:!0}})),r&&r(c),e.getState().events.connected||c.events.connect==null||c.events.connect(i)},[]),u.createElement(xt.Provider,{value:e},t)}function St(e,t){const r=ce.get(e),i=r==null?void 0:r.fiber;if(i){const c=r==null?void 0:r.store.getState();c&&(c.internal.active=!1),Me.updateContainer(null,i,null,()=>{c&&setTimeout(()=>{try{var a,h,v,s;c.events.disconnect==null||c.events.disconnect(),(a=c.gl)==null||(h=a.renderLists)==null||h.dispose==null||h.dispose(),(v=c.gl)==null||v.forceContextLoss==null||v.forceContextLoss(),(s=c.gl)!=null&&s.xr&&c.xr.disconnect(),Or(c),ce.delete(e),t&&t(e)}catch{}},500)})}}Me.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:u.version});const ke={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Gr(e){const{handlePointer:t}=Lr(e);return{priority:1,enabled:!0,compute(r,i,c){i.pointer.set(r.offsetX/i.size.width*2-1,-(r.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(ke).reduce((r,i)=>({...r,[i]:t(i)}),{}),update:()=>{var r;const{events:i,internal:c}=e.getState();(r=c.lastEvent)!=null&&r.current&&i.handlers&&i.handlers.onPointerMove(c.lastEvent.current)},connect:r=>{var i;const{set:c,events:a}=e.getState();a.disconnect==null||a.disconnect(),c(h=>({events:{...h.events,connected:r}})),Object.entries((i=a.handlers)!=null?i:[]).forEach(([h,v])=>{const[s,y]=ke[h];r.addEventListener(s,v,{passive:y})})},disconnect:()=>{const{set:r,events:i}=e.getState();if(i.connected){var c;Object.entries((c=i.handlers)!=null?c:[]).forEach(([a,h])=>{if(i&&i.connected instanceof HTMLElement){const[v]=ke[a];i.connected.removeEventListener(v,h)}}),r(a=>({events:{...a.events,connected:void 0}}))}}}}const Ur=u.forwardRef(function({children:t,fallback:r,resize:i,style:c,gl:a,events:h=Gr,eventSource:v,eventPrefix:s,shadows:y,linear:n,flat:o,legacy:m,orthographic:d,frameloop:p,dpr:M,performance:g,raycaster:l,camera:f,scene:b,onPointerMissed:x,onCreated:_,...E},S){u.useMemo(()=>Mr(rr),[]);const R=mr(),[P,O]=dr({scroll:!0,debounce:{scroll:50,resize:0},...i}),w=u.useRef(null),A=u.useRef(null);u.useImperativeHandle(S,()=>w.current);const I=gt(x),[K,k]=u.useState(!1),[q,F]=u.useState(!1);if(K)throw K;if(q)throw q;const H=u.useRef(null);me(()=>{const T=w.current;O.width>0&&O.height>0&&T&&(H.current||(H.current=Br(T)),H.current.configure({gl:a,events:h,shadows:y,linear:n,flat:o,legacy:m,orthographic:d,frameloop:p,dpr:M,performance:g,raycaster:l,camera:f,scene:b,size:O,onPointerMissed:(...L)=>I.current==null?void 0:I.current(...L),onCreated:L=>{L.events.connect==null||L.events.connect(v?Pr(v)?v.current:v:A.current),s&&L.setEvents({compute:(z,C)=>{const Y=z[s+"X"],V=z[s+"Y"];C.pointer.set(Y/C.size.width*2-1,-(V/C.size.height)*2+1),C.raycaster.setFromCamera(C.pointer,C.camera)}}),_==null||_(L)}}),H.current.render(u.createElement(R,null,u.createElement(yt,{set:F},u.createElement(u.Suspense,{fallback:u.createElement(Cr,{set:k})},t)))))}),u.useEffect(()=>{const T=w.current;if(T)return()=>St(T)},[]);const W=v?"none":"auto";return u.createElement("div",U({ref:A,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:W,...c}},E),u.createElement("div",{ref:P,style:{width:"100%",height:"100%"}},u.createElement("canvas",{ref:w,style:{display:"block"}},r)))}),wn=u.forwardRef(function(t,r){return u.createElement(pr,null,u.createElement(Ur,U({},t,{ref:r})))}),he=new N,qe=new N,qr=new N,ct=new dt;function Vr(e,t,r){const i=he.setFromMatrixPosition(e.matrixWorld);i.project(t);const c=r.width/2,a=r.height/2;return[i.x*c+c,-(i.y*a)+a]}function Xr(e,t){const r=he.setFromMatrixPosition(e.matrixWorld),i=qe.setFromMatrixPosition(t.matrixWorld),c=r.sub(i),a=t.getWorldDirection(qr);return c.angleTo(a)>Math.PI/2}function Yr(e,t,r,i){const c=he.setFromMatrixPosition(e.matrixWorld),a=c.clone();a.project(t),ct.set(a.x,a.y),r.setFromCamera(ct,t);const h=r.intersectObjects(i,!0);if(h.length){const v=h[0].distance;return c.distanceTo(r.ray.origin)<v}return!0}function Zr(e,t){if(t instanceof $e)return t.zoom;if(t instanceof Be){const r=he.setFromMatrixPosition(e.matrixWorld),i=qe.setFromMatrixPosition(t.matrixWorld),c=t.fov*Math.PI/180,a=r.distanceTo(i);return 1/(2*Math.tan(c/2)*a)}else return 1}function Kr(e,t,r){if(t instanceof Be||t instanceof $e){const i=he.setFromMatrixPosition(e.matrixWorld),c=qe.setFromMatrixPosition(t.matrixWorld),a=i.distanceTo(c),h=(r[1]-r[0])/(t.far-t.near),v=r[1]-h*t.far;return Math.round(h*a+v)}}const We=e=>Math.abs(e)<1e-10?0:e;function Rt(e,t,r=""){let i="matrix3d(";for(let c=0;c!==16;c++)i+=We(t[c]*e.elements[c])+(c!==15?",":")");return r+i}const Jr=(e=>t=>Rt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Qr=(e=>(t,r)=>Rt(t,e(r),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function en(e){return e&&typeof e=="object"&&"current"in e}const En=u.forwardRef(({children:e,eps:t=.001,style:r,className:i,prepend:c,center:a,fullscreen:h,portal:v,distanceFactor:s,sprite:y=!1,transform:n=!1,occlude:o,onOcclude:m,castShadow:d,receiveShadow:p,material:M,geometry:g,zIndexRange:l=[16777271,0],calculatePosition:f=Vr,as:b="div",wrapperClass:x,pointerEvents:_="auto",...E},S)=>{const{gl:R,camera:P,scene:O,size:w,raycaster:A,events:I,viewport:K}=B(),[k]=u.useState(()=>document.createElement(b)),q=u.useRef(),F=u.useRef(null),H=u.useRef(0),W=u.useRef([0,0]),T=u.useRef(null),L=u.useRef(null),z=(v==null?void 0:v.current)||I.connected||R.domElement.parentNode,C=u.useRef(null),Y=u.useRef(!1),V=u.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&en(o[0]),[o]);u.useLayoutEffect(()=>{const $=R.domElement;o&&o==="blending"?($.style.zIndex=`${Math.floor(l[0]/2)}`,$.style.position="absolute",$.style.pointerEvents="none"):($.style.zIndex=null,$.style.position=null,$.style.pointerEvents=null)},[o]),u.useLayoutEffect(()=>{if(F.current){const $=q.current=hr(k);if(O.updateMatrixWorld(),n)k.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const j=f(F.current,P,w);k.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${j[0]}px,${j[1]}px,0);transform-origin:0 0;`}return z&&(c?z.prepend(k):z.appendChild(k)),()=>{z&&z.removeChild(k),$.unmount()}}},[z,n]),u.useLayoutEffect(()=>{x&&(k.className=x)},[x]);const Xe=u.useMemo(()=>n?{position:"absolute",top:0,left:0,width:w.width,height:w.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:a?"translate3d(-50%,-50%,0)":"none",...h&&{top:-w.height/2,left:-w.width/2,width:w.width,height:w.height},...r},[r,a,h,w,n]),Dt=u.useMemo(()=>({position:"absolute",pointerEvents:_}),[_]);u.useLayoutEffect(()=>{if(Y.current=!1,n){var $;($=q.current)==null||$.render(u.createElement("div",{ref:T,style:Xe},u.createElement("div",{ref:L,style:Dt},u.createElement("div",{ref:S,className:i,style:r,children:e}))))}else{var j;(j=q.current)==null||j.render(u.createElement("div",{ref:S,style:Xe,className:i,children:e}))}});const re=u.useRef(!0);ve($=>{if(F.current){P.updateMatrixWorld(),F.current.updateWorldMatrix(!0,!1);const j=n?W.current:f(F.current,P,w);if(n||Math.abs(H.current-P.zoom)>t||Math.abs(W.current[0]-j[0])>t||Math.abs(W.current[1]-j[1])>t){const J=Xr(F.current,P);let X=!1;V&&(Array.isArray(o)?X=o.map(Q=>Q.current):o!=="blending"&&(X=[O]));const le=re.current;if(X){const Q=Yr(F.current,P,A,X);re.current=Q&&!J}else re.current=!J;le!==re.current&&(m?m(!re.current):k.style.display=re.current?"block":"none");const ge=Math.floor(l[0]/2),Lt=o?V?[l[0],ge]:[ge-1,0]:l;if(k.style.zIndex=`${Kr(F.current,P,Lt)}`,n){const[Q,Ze]=[w.width/2,w.height/2],xe=P.projectionMatrix.elements[5]*Ze,{isOrthographicCamera:Ke,top:kt,left:Ft,bottom:zt,right:It}=P,Ht=Jr(P.matrixWorldInverse),Wt=Ke?`scale(${xe})translate(${We(-(It+Ft)/2)}px,${We((kt+zt)/2)}px)`:`translateZ(${xe}px)`;let ee=F.current.matrixWorld;y&&(ee=P.matrixWorldInverse.clone().transpose().copyPosition(ee).scale(F.current.scale),ee.elements[3]=ee.elements[7]=ee.elements[11]=0,ee.elements[15]=1),k.style.width=w.width+"px",k.style.height=w.height+"px",k.style.perspective=Ke?"":`${xe}px`,T.current&&L.current&&(T.current.style.transform=`${Wt}${Ht}translate(${Q}px,${Ze}px)`,L.current.style.transform=Qr(ee,1/((s||10)/400)))}else{const Q=s===void 0?1:Zr(F.current,P)*s;k.style.transform=`translate3d(${j[0]}px,${j[1]}px,0) scale(${Q})`}W.current=j,H.current=P.zoom}}if(!V&&C.current&&!Y.current)if(n){if(T.current){const j=T.current.children[0];if(j!=null&&j.clientWidth&&j!=null&&j.clientHeight){const{isOrthographicCamera:J}=P;if(J||g)E.scale&&(Array.isArray(E.scale)?E.scale instanceof N?C.current.scale.copy(E.scale.clone().divideScalar(1)):C.current.scale.set(1/E.scale[0],1/E.scale[1],1/E.scale[2]):C.current.scale.setScalar(1/E.scale));else{const X=(s||10)/400,le=j.clientWidth*X,ge=j.clientHeight*X;C.current.scale.set(le,ge,1)}Y.current=!0}}}else{const j=k.children[0];if(j!=null&&j.clientWidth&&j!=null&&j.clientHeight){const J=1/K.factor,X=j.clientWidth*J,le=j.clientHeight*J;C.current.scale.set(X,le,1),Y.current=!0}C.current.lookAt($.camera.position)}});const Ye=u.useMemo(()=>({vertexShader:n?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[n]);return u.createElement("group",U({},E,{ref:F}),o&&!V&&u.createElement("mesh",{castShadow:d,receiveShadow:p,ref:C},g||u.createElement("planeGeometry",null),M||u.createElement("shaderMaterial",{side:nr,vertexShader:Ye.vertexShader,fragmentShader:Ye.fragmentShader})))});let de=0;const _n=mt(e=>(ye.onStart=(t,r,i)=>{e({active:!0,item:t,loaded:r,total:i,progress:(r-de)/(i-de)*100})},ye.onLoad=()=>{e({active:!1})},ye.onError=t=>e(r=>({errors:[...r.errors,t]})),ye.onProgress=(t,r,i)=>{r===i&&(de=i),e({active:!0,item:t,loaded:r,total:i,progress:(r-de)/(i-de)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),lt=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function Ot(e,t){const r=B(a=>a.gl),i=Z(Ne,lt(e)?Object.values(e):e);return u.useLayoutEffect(()=>{t==null||t(i)},[t]),u.useEffect(()=>{"initTexture"in r&&(Array.isArray(i)?i:[i]).forEach(r.initTexture)},[r,i]),u.useMemo(()=>{if(lt(e)){const a={};let h=0;for(const v in e)a[v]=i[h++];return a}else return i},[e,i])}Ot.preload=e=>Z.preload(Ne,e);Ot.clear=e=>Z.clear(Ne,e);const tn=()=>parseInt(or.replace(/\D+/g,"")),At=tn();function rn(e){return Array.isArray(e)}function Fe(e=[0,0,0]){return rn(e)?e:e instanceof N||e instanceof pt?[e.x,e.y,e.z]:[e,e,e]}const Mn=u.forwardRef(function({debug:t,depthTest:r=!1,polygonOffsetFactor:i=-10,map:c,mesh:a,children:h,position:v,rotation:s,scale:y,...n},o){const m=u.useRef(null);u.useImperativeHandle(o,()=>m.current);const d=u.useRef(null);return u.useLayoutEffect(()=>{const p=(a==null?void 0:a.current)||m.current.parent,M=m.current;if(!(p instanceof ir))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const g={position:new N,rotation:new pt,scale:new N(1,1,1)};if(p){G(g,{position:v,scale:y});const l=p.matrixWorld.clone();if(p.matrixWorld.identity(),!s||typeof s=="number"){const f=new sr;f.position.copy(g.position),f.lookAt(p.position),typeof s=="number"&&f.rotateZ(s),G(g,{rotation:f.rotation})}else G(g,{rotation:s});return M.geometry=new gr(p,g.position,g.rotation,g.scale),d.current&&(G(d.current,g),d.current.traverse(f=>f.raycast=()=>null)),p.matrixWorld=l,()=>{M.geometry.dispose()}}},[a,...Fe(v),...Fe(y),...Fe(s)]),u.createElement("mesh",U({ref:m,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":i,"material-depthTest":r,"material-map":c},n),h,t&&u.createElement("mesh",{ref:d},u.createElement("boxGeometry",null),u.createElement("meshNormalMaterial",{wireframe:!0}),u.createElement("axesHelper",null)))});let Ee=null,Tt="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function jt(e,t,r){return i=>{r&&r(i),e&&(Ee||(Ee=new yr),Ee.setDecoderPath(typeof e=="string"?e:Tt),i.setDRACOLoader(Ee)),t&&i.setMeshoptDecoder(typeof Se=="function"?Se():Se)}}function Ve(e,t=!0,r=!0,i){return Z(Ge,e,jt(t,r,i))}Ve.preload=(e,t=!0,r=!0,i)=>Z.preload(Ge,e,jt(t,r,i));Ve.clear=e=>Z.clear(Ge,e);Ve.setDecoderPath=e=>{Tt=e};const xn=u.forwardRef(({makeDefault:e,camera:t,regress:r,domElement:i,enableDamping:c=!0,keyEvents:a=!1,onChange:h,onStart:v,onEnd:s,...y},n)=>{const o=B(E=>E.invalidate),m=B(E=>E.camera),d=B(E=>E.gl),p=B(E=>E.events),M=B(E=>E.setEvents),g=B(E=>E.set),l=B(E=>E.get),f=B(E=>E.performance),b=t||m,x=i||p.connected||d.domElement,_=u.useMemo(()=>new br(b),[b]);return ve(()=>{_.enabled&&_.update()},-1),u.useEffect(()=>(a&&_.connect(a===!0?x:a),_.connect(x),()=>void _.dispose()),[a,x,r,_,o]),u.useEffect(()=>{const E=P=>{o(),r&&f.regress(),h&&h(P)},S=P=>{v&&v(P)},R=P=>{s&&s(P)};return _.addEventListener("change",E),_.addEventListener("start",S),_.addEventListener("end",R),()=>{_.removeEventListener("start",S),_.removeEventListener("end",R),_.removeEventListener("change",E)}},[h,v,s,_,o,M]),u.useEffect(()=>{if(e){const E=l().controls;return g({controls:_}),()=>g({controls:E})}},[e,_]),u.createElement("primitive",U({ref:n,object:_,enableDamping:c},y))}),ze=At>=154?"opaque_fragment":"output_fragment";class nn extends ar{constructor(t){super(t),this.onBeforeCompile=(r,i)=>{const{isWebGL2:c}=i.capabilities;r.fragmentShader=r.fragmentShader.replace(`#include <${ze}>`,`
        ${c?`#include <${ze}>`:`#extension GL_OES_standard_derivatives : enable
#include <${ze}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${At>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const Pn=u.forwardRef((e,t)=>{const[r]=u.useState(()=>new nn(null));return u.createElement("primitive",U({},e,{object:r,ref:t,attach:"material"}))}),Cn=u.forwardRef(({children:e,enabled:t=!0,speed:r=1,rotationIntensity:i=1,floatIntensity:c=1,floatingRange:a=[-.1,.1],...h},v)=>{const s=u.useRef(null);u.useImperativeHandle(v,()=>s.current,[]);const y=u.useRef(Math.random()*1e4);return ve(n=>{var o,m;if(!t||r===0)return;const d=y.current+n.clock.getElapsedTime();s.current.rotation.x=Math.cos(d/4*r)/8*i,s.current.rotation.y=Math.sin(d/4*r)/8*i,s.current.rotation.z=Math.sin(d/4*r)/20*i;let p=Math.sin(d/4*r)/10;p=cr.mapLinear(p,-.1,.1,(o=a==null?void 0:a[0])!==null&&o!==void 0?o:-.1,(m=a==null?void 0:a[1])!==null&&m!==void 0?m:.1),s.current.position.y=p*c,s.current.updateMatrix()}),u.createElement("group",h,u.createElement("group",{ref:s,matrixAutoUpdate:!1},e))});let te,pe;const on=u.createContext(null),ut=new lr,ft=new N,sn=u.forwardRef(({children:e,range:t,limit:r=1e3,...i},c)=>{const a=u.useRef(null);u.useImperativeHandle(c,()=>a.current,[]);const[h,v]=u.useState([]),[[s,y,n]]=u.useState(()=>[new Float32Array(r*3),Float32Array.from({length:r*3},()=>1),Float32Array.from({length:r},()=>1)]);u.useEffect(()=>{a.current.geometry.attributes.position.needsUpdate=!0}),ve(()=>{for(a.current.updateMatrix(),a.current.updateMatrixWorld(),ut.copy(a.current.matrixWorld).invert(),a.current.geometry.drawRange.count=Math.min(r,t!==void 0?t:r,h.length),te=0;te<h.length;te++)pe=h[te].current,pe.getWorldPosition(ft).applyMatrix4(ut),ft.toArray(s,te*3),a.current.geometry.attributes.position.needsUpdate=!0,pe.matrixWorldNeedsUpdate=!0,pe.color.toArray(y,te*3),a.current.geometry.attributes.color.needsUpdate=!0,n.set([pe.size],te),a.current.geometry.attributes.size.needsUpdate=!0});const o=u.useMemo(()=>({getParent:()=>a,subscribe:m=>(v(d=>[...d,m]),()=>v(d=>d.filter(p=>p.current!==m.current)))}),[]);return u.createElement("points",U({userData:{instances:h},matrixAutoUpdate:!1,ref:a,raycast:()=>null},i),u.createElement("bufferGeometry",null,u.createElement("bufferAttribute",{attach:"attributes-position",count:s.length/3,array:s,itemSize:3,usage:ae}),u.createElement("bufferAttribute",{attach:"attributes-color",count:y.length/3,array:y,itemSize:3,usage:ae}),u.createElement("bufferAttribute",{attach:"attributes-size",count:n.length,array:n,itemSize:1,usage:ae})),u.createElement(on.Provider,{value:o},e))}),an=u.forwardRef(({children:e,positions:t,colors:r,sizes:i,stride:c=3,...a},h)=>{const v=u.useRef(null);return u.useImperativeHandle(h,()=>v.current,[]),ve(()=>{const s=v.current.geometry.attributes;s.position.needsUpdate=!0,r&&(s.color.needsUpdate=!0),i&&(s.size.needsUpdate=!0)}),u.createElement("points",U({ref:v},a),u.createElement("bufferGeometry",null,u.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/c,array:t,itemSize:c,usage:ae}),r&&u.createElement("bufferAttribute",{attach:"attributes-color",count:r.length/c,array:r,itemSize:3,usage:ae}),i&&u.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/c,array:i,itemSize:1,usage:ae})),e)}),Sn=u.forwardRef((e,t)=>e.positions instanceof Float32Array?u.createElement(an,U({},e,{ref:t})):u.createElement(sn,U({},e,{ref:t})));function Rn({all:e,scene:t,camera:r}){const i=B(({gl:h})=>h),c=B(({camera:h})=>h),a=B(({scene:h})=>h);return u.useLayoutEffect(()=>{const h=[];e&&(t||a).traverse(y=>{y.visible===!1&&(h.push(y),y.visible=!0)}),i.compile(t||a,r||c);const v=new ur(128);new fr(.01,1e5,v).update(i,t||a),v.dispose(),h.forEach(y=>y.visible=!1)},[]),null}export{wn as C,Mn as D,Cn as F,En as H,xn as O,Rn as P,Ve as a,Ot as b,ve as c,Sn as d,Pn as e,_n as u};
